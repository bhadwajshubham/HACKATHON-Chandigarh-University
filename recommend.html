<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crop Recommendations - Kisan Mitra</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Optional: Basic styling for the new button to make it look like a link */
        .location-btn {
            background: none;
            border: none;
            color: #007bff; /* A standard link blue color */
            cursor: pointer;
            font-size: 0.9em;
            padding: 0;
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <a href="index.html" class="logo"> Kisan Mitra</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="rent.html">Rent</a></li>
                <li><a href="diagnose.html">Diagnose</a></li>
                <li><a href="sell.html">Sell</a></li>
                <li><a href="recommend.html" class="active">Recommend</a></li>
                <li><a href="community.html">Community</a></li>
            </ul>
        </nav>
    </header>

    <main class="page-main">
        <div class="container grid-container">
            <div class="card">
                <h2>Tell Us About Your Farm</h2>
                <form id="recommend-form">
                    <div class="form-group">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <label for="location">Location *</label>
                            <button type="button" id="current-location-btn" class="location-btn">üìç Use Current Location</button>
                        </div>
                        <div class="form-row">
                            <select id="state"><option>Select State</option></select>
                            <select id="district"><option>Select District</option></select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Soil Type *</label>
                        <div class="radio-grid">
                            <label class="radio-label"><input type="radio" name="soil" value="clay"> Clay Soil</label>
                            <label class="radio-label"><input type="radio" name="soil" value="sandy"> Sandy Soil</label>
                            <label class="radio-label"><input type="radio" name="soil" value="loamy"> Loamy Soil</label>
                            <label class="radio-label"><input type="radio" name="soil" value="black"> Black Soil</label>
                        </div>
                    </div>
                     <div class="form-row">
                        <div class="form-group">
                            <label for="farm-size">Farm Size (Acres)</label>
                            <input type="number" id="farm-size" placeholder="Enter farm size">
                        </div>
                        <div class="form-group">
                            <label for="water">Water Availability</label>
                            <select id="water"><option>Select Irrigation</option></select>
                        </div>
                    </div>
                     <div class="form-group">
                        <label for="planting-month">Planting Month *</label>
                        <select id="planting-month"><option>Select Month</option></select>
                    </div>
                    <div class="form-group">
                        <label for="previous-crop">Previous Crop (Optional)</label>
                        <input type="text" id="previous-crop" placeholder="What did you grow last season?">
                    </div>
                    <div class="form-group">
                        <label for="budget">Investment Budget (‚Çπ)</label>
                        <select id="budget"><option>Select Budget Range</option></select>
                    </div>
                    <div class="form-group">
                        <label>Farming Preferences</label>
                        <div class="radio-column">
                            <label><input type="radio" name="preference"> Organic farming preferred</label>
                            <label><input type="radio" name="preference"> High market demand crops</label>
                            <label><input type="radio" name="preference"> Climate-resilient varieties</label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary full-width">üåø Get Recommendations</button>
                </form>
            </div>
            <div class="card">
                <h2>Recommended Crops</h2>
                <div class="results-area" id="recommend-results-area">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#cccccc" viewBox="0 0 256 256"><path d="M223.2,85.11,198.89,26.8a8,8,0,0,0-7.78-5.11H64.89a8,8,0,0,0-7.78,5.11L32.8,85.11A8,8,0,0,0,32,88.78V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V88.78A8,8,0,0,0,223.2,85.11ZM192,208H64V160H192Zm0-64H64V96H192ZM69.11,40h117.8l16,40H53.11Z"></path></svg>
                    <p>Fill out the form to get personalized recommendations.<br>Our AI will analyze your conditions and suggest the best crops.</p>
                </div>
            </div>
        </div>
    </main>
    <script src="js/script.js"></script>
    <script>
        const locationButton = document.getElementById('current-location-btn');
        const stateSelect = document.getElementById('state');
        const districtSelect = document.getElementById('district');

        locationButton.addEventListener('click', () => {
            // Check if Geolocation is supported by the browser
            if (!navigator.geolocation) {
                alert("Geolocation is not supported by your browser.");
                return;
            }

            // Disable button and show feedback
            locationButton.disabled = true;
            locationButton.textContent = 'Locating...';

            // Get current position
            navigator.geolocation.getCurrentPosition(success, error);
        });

        async function success(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            
            // Use Nominatim API for reverse geocoding
            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`);
            const data = await response.json();

            if (data && data.address) {
                // The key for district can vary, so we check for common ones
                const state = data.address.state || '';
                const district = data.address.state_district || data.address.county || '';

                // Populate the state dropdown
                if (state) {
                    stateSelect.innerHTML = `<option value="${state}" selected>${state}</option>`;
                } else {
                     stateSelect.innerHTML = `<option selected>State not found</option>`;
                }

                // Populate the district dropdown
                if (district) {
                    districtSelect.innerHTML = `<option value="${district}" selected>${district}</option>`;
                } else {
                    districtSelect.innerHTML = `<option selected>District not found</option>`;
                }
            } else {
                alert('Could not determine your location. Please select it manually.');
            }
            
            // Re-enable the button
            locationButton.disabled = false;
            locationButton.textContent = 'Use Current Location';
        }

        function error(err) {
            let message = '';
            switch(err.code) {
                case err.PERMISSION_DENIED:
                    message = "You denied the request for Geolocation.";
                    break;
                case err.POSITION_UNAVAILABLE:
                    message = "Location information is unavailable.";
                    break;
                case err.TIMEOUT:
                    message = "The request to get user location timed out.";
                    break;
                default:
                    message = "An unknown error occurred.";
                    break;
            }
            alert(message);
            
            // Re-enable the button
            locationButton.disabled = false;
            locationButton.textContent = ' Use Current Location';
        }
    </script>
</body>
</html>